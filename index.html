<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vigard Calc — FINAL</title>
  <style>
    body{font-family:system-ui;margin:0;padding:20px;background:#f7f7f8;color:#111}
    h1{margin:0 0 20px;font-size:22px}
    .card{background:#fff;border:1px solid #ccc;border-radius:10px;padding:16px;margin-bottom:16px}
    label{display:block;font-size:14px;margin:8px 0 4px}
    input,select,button{padding:6px 8px;border:1px solid #ccc;border-radius:6px;font-size:14px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #ddd;padding:6px;text-align:left;font-size:13px}
    th{background:#f0f0f0}
    .row{display:grid;gap:8px}
    @media(min-width:720px){.row.cols-2{grid-template-columns:1fr 1fr}.row.cols-3{grid-template-columns:1fr 1fr 1fr}}
  </style>
</head>
<body>
  <h1>Вигард — калькулятор наливных грузов (FINAL)</h1>

  <div class="card">
    <h3>Тягачи</h3>
    <div class="row cols-3" style="align-items:end">
      <div><label>Госномер</label><input id="truckPlate" placeholder="А 123 БВ 123"></div>
      <div><label>Оси</label><select id="truckAx"><option value="2">2</option><option value="3">3</option></select></div>
      <div><button onclick="addTractor()">+ Добавить тягач</button></div>
    </div>
    <table id="tractorTable"><thead><tr><th>Госномер</th><th>Оси</th></tr></thead><tbody></tbody></table>
  </div>

  <div class="card">
    <h3>Грузы</h3>
    <div class="row cols-3" style="align-items:end">
      <div><label>Название</label><input id="cargoName" placeholder="Патока / Винилацетат / ..."></div>
      <div><label>ρ (кг/л)</label><input id="cargoRho" type="number" step="0.001" placeholder="1.300"></div>
      <div><button onclick="addCargo()">+ Добавить груз</button></div>
    </div>

    <table id="cargoTable">
      <thead>
        <tr>
          <th>Название</th><th>ρ (кг/л)</th>
          <th>л</th><th>кг</th><th>т</th><th>м³</th>
        </tr>
      </thead>
      <tbody id="cargoBody"></tbody>
    </table>
  </div>

  <div class="card">
    <h3>Маршрут</h3>
    <div class="row cols-3">
      <div><label>Откуда</label><input id="from" placeholder="Кропоткин"></div>
      <div><label>Куда</label><input id="to" placeholder="Краснодар"></div>
      <div style="align-self:end"><button onclick="getDistance()">Рассчитать расстояние</button></div>
    </div>
    <div id="distOut" style="margin-top:8px;color:#444"></div>
  </div>

<script>
// ===== база =====
const tractors=[], cargos=[];
function $(id){return document.getElementById(id)}
function num(v,def=0){const n=parseFloat(v);return isFinite(n)?n:def}

// ===== тягачи =====
function addTractor(){
  const plate=$('truckPlate').value.trim(); if(!plate) return alert('Госномер?');
  const ax=parseInt($('truckAx').value)||2;
  tractors.push({plate,ax}); renderTractors();
  $('truckPlate').value='';
}
function renderTractors(){
  const tb=document.querySelector('#tractorTable tbody'); tb.innerHTML='';
  tractors.forEach(t=>tb.innerHTML+=`<tr><td>${t.plate}</td><td>${t.ax}</td></tr>`);
}

// ===== грузы =====
function addCargo(){
  const name=$('cargoName').value.trim(); if(!name) return alert('Название?');
  const rho=num($('cargoRho').value, NaN); if(!isFinite(rho)||rho<=0) return alert('Укажи ρ (кг/л)');
  cargos.push({name,rho,L:0,KG:0,T:0,M3:0}); renderCargos();
  $('cargoName').value=''; $('cargoRho').value='';
}
function renderCargos(){
  const tb=$('cargoBody'); tb.innerHTML='';
  cargos.forEach((c,idx)=>{
    tb.innerHTML+=`
      <tr data-i="${idx}">
        <td>${c.name}</td>
        <td>${c.rho}</td>
        <td><input class="l" type="number" value="${c.L||''}" placeholder="л"></td>
        <td><input class="kg" type="number" value="${c.KG||''}" placeholder="кг"></td>
        <td><input class="t" type="number" value="${c.T||''}" placeholder="т"></td>
        <td><input class="m3" type="number" value="${c.M3||''}" placeholder="м³"></td>
      </tr>`;
  });
  // бинды
  [...tb.querySelectorAll('tr')].forEach(tr=>{
    const i=parseInt(tr.dataset.i);
    tr.querySelectorAll('input').forEach(inp=>{
      inp.addEventListener('input',()=>{
        const rho=cargos[i].rho;
        let L = num(tr.querySelector('.l').value, NaN);
        let KG= num(tr.querySelector('.kg').value, NaN);
        let T = num(tr.querySelector('.t').value, NaN);
        let M3= num(tr.querySelector('.m3').value, NaN);
        // приоритет: т > м3 > кг > л
        if(isFinite(T)){ KG=T*1000; L=rho>0?KG/rho:0; M3=L/1000; }
        else if(isFinite(M3)){ L=M3*1000; KG=L*rho; T=KG/1000; }
        else if(isFinite(KG)){ L=rho>0?KG/rho:0; T=KG/1000; M3=L/1000; }
        else if(isFinite(L)){ KG=L*rho; T=KG/1000; M3=L/1000; }
        else { L=KG=T=M3=0; }

        tr.querySelector('.l').value=Math.round(L)||'';
        tr.querySelector('.kg').value=Math.round(KG)||'';
        tr.querySelector('.t').value=(T?T.toFixed(3):'');
        tr.querySelector('.m3').value=(M3?M3.toFixed(3):'');

        cargos[i].L=L; cargos[i].KG=KG; cargos[i].T=T; cargos[i].M3=M3;
      });
    });
  });
}

// ===== distance (Google) =====
function getDistance(){
  const from=$('from').value.trim(), to=$('to').value.trim();
  if(!from||!to) return alert('Укажи города');
  if(!window.google||!google.maps||!google.maps.DistanceMatrixService){
    alert('Google API не загружен (проверь ключ внизу файла)'); return;
  }
  const svc=new google.maps.DistanceMatrixService();
  svc.getDistanceMatrix({origins:[from],destinations:[to],travelMode:'DRIVING'},
    (res,status)=>{
      if(status!=='OK'){ $('distOut').textContent='Ошибка API: '+status; return; }
      try{
        const km=res.rows[0].elements[0].distance.value/1000;
        $('distOut').textContent='Расстояние: '+km+' км';
      }catch(_){ $('distOut').textContent='Не удалось разобрать ответ'; }
    });
}
</script>
<!-- ВСТАВЬ СВОЙ КЛЮЧ СЮДА ↓↓↓ -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
</body>
</html>
